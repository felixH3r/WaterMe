{"version":3,"file":"bs-dropdown.directive.js","sources":["../../src/dropdown/bs-dropdown.directive.ts"],"names":[],"mappings":"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","sourcesContent":["import {\n  Directive, ElementRef, EmbeddedViewRef, EventEmitter, HostBinding, Input, OnDestroy, OnInit, Output,\n  Renderer, ViewContainerRef\n} from '@angular/core';\nimport { Subscription } from 'rxjs/Subscription';\nimport 'rxjs/add/operator/filter';\nimport { ComponentLoader, ComponentLoaderFactory } from '../component-loader';\n\nimport { BsDropdownConfig } from './bs-dropdown.config';\nimport { BsDropdownContainerComponent } from './bs-dropdown-container.component';\nimport { BsDropdownState } from './bs-dropdown.state';\nimport { BsComponentRef } from '../component-loader/bs-component-ref.class';\nimport { BsDropdownMenuDirective } from './';\nimport { isBs3 } from '../utils/ng2-bootstrap-config';\n\n\nexport class BsDropdownDirective implements OnInit, OnDestroy {\n  /**\n   * Placement of a popover. Accepts: \"top\", \"bottom\", \"left\", \"right\"\n   */\n   placement: string;\n  /**\n   * Specifies events that should trigger. Supports a space separated list of\n   * event names.\n   */\n   triggers: string;\n  /**\n   * A selector specifying the element the popover should be appended to.\n   * Currently only supports \"body\".\n   */\n   container: string;\n\n  /**\n   * This attribute indicates that the dropdown should be opened upwards\n   */\n   dropup: boolean;\n\n  /**\n   * Indicates that dropdown will be closed on item or document click,\n   * and after pressing ESC\n   */\n   set autoClose(value: boolean) {\n    if (typeof value === 'boolean') {\n      this._state.autoClose = value;\n    }\n  };\n\n  get autoClose(): boolean {\n    return this._state.autoClose;\n  }\n\n  /**\n   * Disables dropdown toggle and hides dropdown menu if opened\n   */\n   set isDisabled(value: boolean) {\n    this._isDisabled = value;\n    this._state.isDisabledChange.emit(value);\n    if (value) {\n      this.hide();\n    }\n  }\n\n  get isDisabled(): boolean { return this._isDisabled; }\n\n  /**\n   * Returns whether or not the popover is currently being shown\n   */\n   get isOpen(): boolean {\n    if (this._showInline) {\n      return this._isInlineOpen;\n    }\n    return this._dropdown.isShown;\n  }\n\n  set isOpen(value: boolean) {\n    if (value) {\n      this.show();\n    } else {\n      this.hide();\n    }\n  }\n\n  /**\n   * Emits an event when the popover is shown\n   */\n   onShown: EventEmitter<any>;\n  /**\n   * Emits an event when the popover is hidden\n   */\n   onHidden: EventEmitter<any>;\n\n  get isBs4(): boolean {\n    return !isBs3();\n  }\n  // todo: move to component loader\n  private _isInlineOpen = false;\n  private _showInline: boolean;\n  private _inlinedMenu: EmbeddedViewRef<BsDropdownMenuDirective>;\n\n  private _isDisabled: boolean;\n  private _dropdown: ComponentLoader<BsDropdownContainerComponent>;\n  private _subscriptions: Subscription[] = [];\n\n  constructor(private _elementRef: ElementRef,\n              private _renderer: Renderer,\n              private _viewContainerRef: ViewContainerRef,\n              private _cis: ComponentLoaderFactory,\n              private _config: BsDropdownConfig,\n              private _state: BsDropdownState) {\n    // create dropdown component loader\n    this._dropdown = this._cis\n      .createLoader<BsDropdownContainerComponent>(this._elementRef, this._viewContainerRef, this._renderer)\n      .provide({provide: BsDropdownState, useValue: this._state});\n\n    this.onShown = this._dropdown.onShown;\n    this.onHidden = this._dropdown.onHidden;\n\n    // set initial dropdown state from config\n    this._state.autoClose = this._config.autoClose;\n  }\n\n  ngOnInit(): void {\n    this._showInline = !this.container;\n\n    // attach DOM listeners\n    this._dropdown.listen({\n      triggers: this.triggers,\n      show: () => this.show()\n    });\n\n    // toggle visibility on toggle element click\n    this._subscriptions.push(this._state\n      .toggleClick.subscribe((value: boolean) => this.toggle(value)));\n\n    // hide dropdown if set disabled while opened\n    this._subscriptions.push(this._state\n      .isDisabledChange\n      .filter((value: boolean) => value === true)\n      .subscribe((value: boolean) => this.hide()));\n\n    // attach dropdown menu inside of dropdown\n    if (this._showInline) {\n      this._state.dropdownMenu\n        .then((dropdownMenu:BsComponentRef<BsDropdownMenuDirective>) => {\n          this._inlinedMenu = dropdownMenu.viewContainer.createEmbeddedView(dropdownMenu.templateRef);\n        });\n    }\n  }\n\n  /**\n   * Opens an element’s popover. This is considered a “manual” triggering of\n   * the popover.\n   */\n  show(): void {\n    if (this.isOpen || this.isDisabled) {\n      return;\n    }\n\n    if (this._showInline) {\n      this._isInlineOpen = true;\n      this._state.isOpenChange.emit(true);\n      return;\n    }\n\n    this._state.dropdownMenu\n      .then((dropdownMenu) => {\n        // check direction in which dropdown should be opened\n        const _dropup = this.dropup === true ||\n          (typeof this.dropup !== 'undefined' && this.dropup !== false);\n        this._state.direction = _dropup ? 'up' : 'down';\n        const _placement = this.placement ||\n          (_dropup ? 'top left' : 'bottom left');\n\n        // show dropdown\n        this._dropdown\n          .attach(BsDropdownContainerComponent)\n          .to(this.container)\n          .position({attachment: _placement})\n          .show({\n            content: dropdownMenu.templateRef,\n            placement: _placement\n          });\n\n        this._state.isOpenChange.emit(true);\n      });\n  }\n\n  /**\n   * Closes an element’s popover. This is considered a “manual” triggering of\n   * the popover.\n   */\n  hide(): void {\n    if (!this.isOpen) {\n      return;\n    }\n\n    if (this._showInline) {\n      this._isInlineOpen = false;\n    } else {\n      this._dropdown.hide();\n    }\n\n    this._state.isOpenChange.emit(false);\n  }\n\n  /**\n   * Toggles an element’s popover. This is considered a “manual” triggering of\n   * the popover.\n   */\n  toggle(value?: boolean): void {\n    if (this.isOpen || value === false) {\n      return this.hide();\n    }\n\n    return this.show();\n  }\n\n  ngOnDestroy(): void {\n    // clean up subscriptions and destroy dropdown\n    for (const sub of this._subscriptions) {\n      sub.unsubscribe();\n    }\n    this._dropdown.dispose();\n  }\nstatic decorators: DecoratorInvocation[] = [\n{ type: Directive, args: [{\n  selector: '[bsDropdown],[dropdown]',\n  exportAs: 'bs-dropdown',\n  providers: [BsDropdownState],\n  host: {\n    '[class.dropup]': 'dropup',\n    '[class.open]': 'isOpen',\n    '[class.show]': 'isOpen && isBs4'\n  }\n}, ] },\n];\n/** @nocollapse */\nstatic ctorParameters: () => ({type: any, decorators?: DecoratorInvocation[]}|null)[] = () => [\n{type: ElementRef, },\n{type: Renderer, },\n{type: ViewContainerRef, },\n{type: ComponentLoaderFactory, },\n{type: BsDropdownConfig, },\n{type: BsDropdownState, },\n];\nstatic propDecorators: {[key: string]: DecoratorInvocation[]} = {\n'placement': [{ type: Input },],\n'triggers': [{ type: Input },],\n'container': [{ type: Input },],\n'dropup': [{ type: Input },],\n'autoClose': [{ type: Input },],\n'isDisabled': [{ type: Input },],\n'isOpen': [{ type: Input },],\n'onShown': [{ type: Output },],\n'onHidden': [{ type: Output },],\n};\n}\n\ninterface DecoratorInvocation {\n  type: Function;\n  args?: any[];\n}\n"]}